<?xml version='1.0' encoding='UTF-8'?>
<matrix-project plugin="matrix-project@1.3">
  <actions/>
  <description>Build all DigabiOS variants&#xd;
&#xd;
First try building amd64/iso-hybrid/client + amd64/iso-hybrid/server, if successful, build other variants.</description>
  <logRotator class="hudson.tasks.LogRotator">
    <daysToKeep>-1</daysToKeep>
    <numToKeep>-1</numToKeep>
    <artifactDaysToKeep>-1</artifactDaysToKeep>
    <artifactNumToKeep>10</artifactNumToKeep>
  </logRotator>
  <keepDependencies>false</keepDependencies>
  <properties>
    <hudson.model.ParametersDefinitionProperty>
      <parameterDefinitions>
        <hudson.model.StringParameterDefinition>
          <name>ROOT_PASSWORD</name>
          <description>Root password for this image.</description>
          <defaultValue>oh-hello-i-need-root</defaultValue>
        </hudson.model.StringParameterDefinition>
        <hudson.model.BooleanParameterDefinition>
          <name>DIGABI_DEBUG</name>
          <description>Is this a debug build? If yes, run 0001-digabi-debug.chroot.hook.</description>
          <defaultValue>false</defaultValue>
        </hudson.model.BooleanParameterDefinition>
        <hudson.model.StringParameterDefinition>
          <name>DEBIAN_MIRROR</name>
          <description>Which Debian mirror we want to use for Vagrant provisioning + building the image? Default is none = use the one specified in jenkins-build.sh.</description>
          <defaultValue></defaultValue>
        </hudson.model.StringParameterDefinition>
        <hudson.model.ChoiceParameterDefinition>
          <name>DIGABI_BUILD_CPUS</name>
          <description>How many CPUs should we use for the Vagrantbox?</description>
          <choices class="java.util.Arrays$ArrayList">
            <a class="string-array">
              <string>4</string>
              <string>8</string>
              <string>1</string>
              <string>2</string>
              <string>16</string>
            </a>
          </choices>
        </hudson.model.ChoiceParameterDefinition>
        <hudson.model.ChoiceParameterDefinition>
          <name>DIGABI_BUILD_MEM</name>
          <description>How much memory should we use for the Vagrantbox?</description>
          <choices class="java.util.Arrays$ArrayList">
            <a class="string-array">
              <string>8192</string>
              <string>4096</string>
              <string>2048</string>
              <string>1024</string>
            </a>
          </choices>
        </hudson.model.ChoiceParameterDefinition>
        <hudson.plugins.matrix__configuration__parameter.MatrixCombinationsParameterDefinition plugin="matrix-combinations-parameter@1.0.7">
          <name>MATRIX_COMBINATIONS</name>
          <description>Which combinations you would like to build?</description>
        </hudson.plugins.matrix__configuration__parameter.MatrixCombinationsParameterDefinition>
        <hudson.model.StringParameterDefinition>
          <name>COMMIT</name>
          <description>Git commit we want to build. By default builds HEAD. Support for this added in 83df634.</description>
          <defaultValue></defaultValue>
        </hudson.model.StringParameterDefinition>
        <hudson.model.ChoiceParameterDefinition>
          <name>VAGRANT_DEFAULT_PROVIDER</name>
          <description>What VM provider should we use with Vagrant?</description>
          <choices class="java.util.Arrays$ArrayList">
            <a class="string-array">
              <string>vmware_workstation</string>
              <string>virtualbox</string>
            </a>
          </choices>
        </hudson.model.ChoiceParameterDefinition>
        <hudson.model.ChoiceParameterDefinition>
          <name>VAGRANT_LOG</name>
          <description>Level of Vagrant logging. (default: info)</description>
          <choices class="java.util.Arrays$ArrayList">
            <a class="string-array">
              <string>warn</string>
              <string>info</string>
              <string>debug</string>
              <string>error</string>
            </a>
          </choices>
        </hudson.model.ChoiceParameterDefinition>
        <hudson.model.ChoiceParameterDefinition>
          <name>DIGABI_NETWORK_TYPE</name>
          <description>What kind of network we want to use? NAT, bridged, ...</description>
          <choices class="java.util.Arrays$ArrayList">
            <a class="string-array">
              <string>bridged</string>
              <string>default</string>
            </a>
          </choices>
        </hudson.model.ChoiceParameterDefinition>
      </parameterDefinitions>
    </hudson.model.ParametersDefinitionProperty>
    <hudson.plugins.throttleconcurrents.ThrottleJobProperty plugin="throttle-concurrents@1.8.3">
      <maxConcurrentPerNode>6</maxConcurrentPerNode>
      <maxConcurrentTotal>0</maxConcurrentTotal>
      <throttleEnabled>true</throttleEnabled>
      <throttleOption>project</throttleOption>
      <matrixOptions>
        <throttleMatrixBuilds>true</throttleMatrixBuilds>
        <throttleMatrixConfigurations>true</throttleMatrixConfigurations>
      </matrixOptions>
    </hudson.plugins.throttleconcurrents.ThrottleJobProperty>
    <hudson.plugins.disk__usage.DiskUsageProperty plugin="disk-usage@0.24"/>
  </properties>
  <scm class="hudson.plugins.git.GitSCM" plugin="git@2.2.4">
    <configVersion>2</configVersion>
    <userRemoteConfigs>
      <hudson.plugins.git.UserRemoteConfig>
        <name>digabi-os</name>
        <url>https://github.com/digabi/digabi-os.git</url>
      </hudson.plugins.git.UserRemoteConfig>
      <hudson.plugins.git.UserRemoteConfig>
        <name>experimental</name>
        <url>git@github.com:digabi/dos-experimental.git</url>
        <credentialsId>fe7c3ee4-3e91-48e1-8bb9-1bd50bc6b747</credentialsId>
      </hudson.plugins.git.UserRemoteConfig>
    </userRemoteConfigs>
    <branches>
      <hudson.plugins.git.BranchSpec>
        <name>digabi-os/master</name>
      </hudson.plugins.git.BranchSpec>
      <hudson.plugins.git.BranchSpec>
        <name>experimental/feature/**</name>
      </hudson.plugins.git.BranchSpec>
    </branches>
    <doGenerateSubmoduleConfigurations>false</doGenerateSubmoduleConfigurations>
    <browser class="hudson.plugins.git.browser.GithubWeb">
      <url>https://github.com/digabi/digabi-os</url>
    </browser>
    <submoduleCfg class="list"/>
    <extensions/>
  </scm>
  <quietPeriod>30</quietPeriod>
  <assignedNode>dos</assignedNode>
  <canRoam>false</canRoam>
  <disabled>false</disabled>
  <blockBuildWhenDownstreamBuilding>false</blockBuildWhenDownstreamBuilding>
  <blockBuildWhenUpstreamBuilding>true</blockBuildWhenUpstreamBuilding>
  <triggers>
    <hudson.triggers.TimerTrigger>
      <spec>H 3 * * *</spec>
    </hudson.triggers.TimerTrigger>
    <hudson.triggers.SCMTrigger>
      <spec>H/5 * * * *</spec>
      <ignorePostCommitHooks>false</ignorePostCommitHooks>
    </hudson.triggers.SCMTrigger>
  </triggers>
  <concurrentBuild>false</concurrentBuild>
  <customWorkspace>/data/jenkins/digabios-workspace</customWorkspace>
  <axes>
    <hudson.matrix.TextAxis>
      <name>ARCH</name>
      <values>
        <string>amd64</string>
        <string>i386</string>
      </values>
    </hudson.matrix.TextAxis>
    <hudson.matrix.TextAxis>
      <name>DIGABI_BUILD_TARGET</name>
      <values>
        <string>default</string>
        <string>client</string>
        <string>server</string>
        <string>client meb</string>
        <string>server meb</string>
      </values>
    </hudson.matrix.TextAxis>
    <hudson.matrix.TextAxis>
      <name>BINARY_IMAGES</name>
      <values>
        <string>hdd</string>
        <string>iso-hybrid</string>
      </values>
    </hudson.matrix.TextAxis>
  </axes>
  <combinationFilter>!(BINARY_IMAGES==&quot;hdd&quot;) &amp;&amp; (ARCH==&quot;i386&quot;).implies(DIGABI_BUILD_TARGET==&quot;client&quot;)</combinationFilter>
  <builders>
    <hudson.tasks.Shell>
      <command>echo &quot;TODO: Build *.deb, publish using debs to repository&quot;</command>
    </hudson.tasks.Shell>
    <hudson.tasks.Shell>
      <command>export REPOSITORY_HOST=&quot;ci.ylioppilastutkinto-offline.fi&quot;
export PROXY_HOST=&quot;cimonitor.ylioppilastutkinto-offline.fi&quot;
export DIGABI_NETWORK_HOST_DEV=&quot;em1&quot;

if [ &quot;${VAGRANT_PROVIDER}&quot; = &quot;virtualbox&quot; ]
then
	VAGRANT_BASEBOX=&quot;dos-builder&quot;
fi

custom-packages/digabi-dev/scripts/_os/jenkins-build stable</command>
    </hudson.tasks.Shell>
  </builders>
  <publishers>
    <hudson.tasks.ArtifactArchiver>
      <artifacts>dist/*</artifacts>
      <latestOnly>false</latestOnly>
      <allowEmptyArchive>false</allowEmptyArchive>
      <onlyIfSuccessful>false</onlyIfSuccessful>
      <defaultExcludes>true</defaultExcludes>
    </hudson.tasks.ArtifactArchiver>
    <hudson.tasks.Fingerprinter>
      <targets></targets>
      <recordBuildArtifacts>true</recordBuildArtifacts>
    </hudson.tasks.Fingerprinter>
    <com.flowdock.jenkins.FlowdockNotifier plugin="jenkins-flowdock-plugin@1.1.3">
      <flowToken>FIXME</flowToken>
      <notificationTags>jenkins, dos</notificationTags>
      <chatNotification>false</chatNotification>
      <notifyMap>
        <entry>
          <com.flowdock.jenkins.BuildResult>ABORTED</com.flowdock.jenkins.BuildResult>
          <boolean>false</boolean>
        </entry>
        <entry>
          <com.flowdock.jenkins.BuildResult>FAILURE</com.flowdock.jenkins.BuildResult>
          <boolean>false</boolean>
        </entry>
        <entry>
          <com.flowdock.jenkins.BuildResult>NOT_BUILT</com.flowdock.jenkins.BuildResult>
          <boolean>false</boolean>
        </entry>
        <entry>
          <com.flowdock.jenkins.BuildResult>SUCCESS</com.flowdock.jenkins.BuildResult>
          <boolean>true</boolean>
        </entry>
        <entry>
          <com.flowdock.jenkins.BuildResult>UNSTABLE</com.flowdock.jenkins.BuildResult>
          <boolean>false</boolean>
        </entry>
        <entry>
          <com.flowdock.jenkins.BuildResult>FIXED</com.flowdock.jenkins.BuildResult>
          <boolean>true</boolean>
        </entry>
      </notifyMap>
      <notifySuccess>true</notifySuccess>
      <notifyFailure>false</notifyFailure>
      <notifyFixed>true</notifyFixed>
      <notifyUnstable>false</notifyUnstable>
      <notifyAborted>false</notifyAborted>
      <notifyNotBuilt>false</notifyNotBuilt>
    </com.flowdock.jenkins.FlowdockNotifier>
    <hudson.plugins.parameterizedtrigger.BuildTrigger plugin="parameterized-trigger@2.25">
      <configs>
        <hudson.plugins.parameterizedtrigger.BuildTriggerConfig>
          <configs>
            <hudson.plugins.parameterizedtrigger.matrix.MatrixSubsetBuildParameters>
              <filter>(DIGABI_BUILD_TARGET==&quot;client meb&quot; &amp;&amp; ARCH==&quot;amd64&quot; &amp;&amp; BINARY_IMAGES=&quot;iso-hybrid&quot;)</filter>
            </hudson.plugins.parameterizedtrigger.matrix.MatrixSubsetBuildParameters>
            <hudson.plugins.parameterizedtrigger.PredefinedBuildParameters>
              <properties>ISO_URL=&quot;http://ci.local/job/digabi-os/ARCH=amd64,BINARY_IMAGES=iso-hybrid,DIGABI_BUILD_TARGET=client%20meb/&quot;</properties>
            </hudson.plugins.parameterizedtrigger.PredefinedBuildParameters>
          </configs>
          <projects>Remaster koe</projects>
          <condition>UNSTABLE_OR_BETTER</condition>
          <triggerWithNoParameters>false</triggerWithNoParameters>
        </hudson.plugins.parameterizedtrigger.BuildTriggerConfig>
        <hudson.plugins.parameterizedtrigger.BuildTriggerConfig>
          <configs>
            <hudson.plugins.parameterizedtrigger.matrix.MatrixSubsetBuildParameters>
              <filter>(DIGABI_BUILD_TARGET==&quot;server meb&quot; &amp;&amp; ARCH==&quot;amd64&quot; &amp;&amp; BINARY_IMAGES=&quot;iso-hybrid&quot;)</filter>
            </hudson.plugins.parameterizedtrigger.matrix.MatrixSubsetBuildParameters>
          </configs>
          <projects>Remaster ktp</projects>
          <condition>UNSTABLE_OR_BETTER</condition>
          <triggerWithNoParameters>false</triggerWithNoParameters>
        </hudson.plugins.parameterizedtrigger.BuildTriggerConfig>
      </configs>
    </hudson.plugins.parameterizedtrigger.BuildTrigger>
  </publishers>
  <buildWrappers>
    <hudson.plugins.timestamper.TimestamperBuildWrapper plugin="timestamper@1.5.14"/>
  </buildWrappers>
  <executionStrategy class="hudson.matrix.DefaultMatrixExecutionStrategyImpl">
    <runSequentially>false</runSequentially>
  </executionStrategy>
</matrix-project>